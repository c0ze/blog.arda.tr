:root {
  --bg1: #ffe29f;
  --bg2: #ffd6a5;
  --bg3: #fdffb6;
  --card: #ffffff;
  --ink: #2a2a3d;
  --muted: #8888aa;
  --accent: #ff8fab;
  --accent-strong: #fb6f92;
  --accent-glow: rgba(255, 143, 171, 0.45);
  --pill: #f3f7ff;
  --border: #e8e6f3;
  --shadow: 0 12px 28px rgba(34, 34, 68, 0.18);
  --gold: #ffda6b;
  --gold-glow: rgba(255, 218, 107, 0.6);
  --deco1: "";
  --deco2: "";
  --deco3: "";
  --deco4: "";
  --deco5: "";
  --deco6: "";
  --bubble1: var(--accent);
  --bubble2: var(--gold);
}

/* ===== Per-character themes ===== */

/* Rusty — warm orange workshop glow, gears & sparks */
body[data-theme="adventures-of-rusty"] {
  --bg1: #ffe0b2; --bg2: #ffcc80; --bg3: #fff3e0;
  --accent: #ff9800; --accent-strong: #f57c00;
  --accent-glow: rgba(255, 152, 0, 0.4);
  --gold: #ffb74d; --gold-glow: rgba(255, 183, 77, 0.5);
  --bubble1: #ffab40; --bubble2: #ffe082;
  --deco1: "\2699"; --deco2: "\2728"; --deco3: "\26a1";
  --deco4: "\2699"; --deco5: "\2b50"; --deco6: "\1f529";
}

/* Captain Barnacles — ocean blues & teals, starfish & waves */
body[data-theme="captain-barnacles-voyages"] {
  --bg1: #e0f7fa; --bg2: #b2ebf2; --bg3: #e0f2f1;
  --accent: #26c6da; --accent-strong: #00acc1;
  --accent-glow: rgba(38, 198, 218, 0.4);
  --gold: #80deea; --gold-glow: rgba(128, 222, 234, 0.5);
  --ink: #1a3a4a;
  --bubble1: #4dd0e1; --bubble2: #a7ffeb;
  --deco1: "\1f41a"; --deco2: "\2b50"; --deco3: "\1f30a";
  --deco4: "\1f42c"; --deco5: "\1f41a"; --deco6: "\2b50";
}

/* Astro-Bun — deep galaxy purple & pink, shooting stars */
body[data-theme="astro-bun-to-the-moon"] {
  --bg1: #ede7f6; --bg2: #e1bee7; --bg3: #f3e5f5;
  --accent: #ba68c8; --accent-strong: #9c27b0;
  --accent-glow: rgba(186, 104, 200, 0.45);
  --gold: #ce93d8; --gold-glow: rgba(206, 147, 216, 0.5);
  --ink: #2a1a3d;
  --bubble1: #ab47bc; --bubble2: #f48fb1;
  --deco1: "\2b50"; --deco2: "\1f31f"; --deco3: "\2728";
  --deco4: "\1f680"; --deco5: "\1f319"; --deco6: "\2604";
}

/* Pippa the Little Plane — sky blue & mint, clouds & breezes */
body[data-theme="pippa-the-little-plane"] {
  --bg1: #e3f2fd; --bg2: #bbdefb; --bg3: #e8f5e9;
  --accent: #42a5f5; --accent-strong: #1e88e5;
  --accent-glow: rgba(66, 165, 245, 0.4);
  --gold: #81d4fa; --gold-glow: rgba(129, 212, 250, 0.5);
  --ink: #1a2a3d;
  --bubble1: #64b5f6; --bubble2: #a5d6a7;
  --deco1: "\2601"; --deco2: "\2708"; --deco3: "\1f4a8";
  --deco4: "\1f308"; --deco5: "\2601"; --deco6: "\2b50";
}

/* Professor Hoot — cozy autumn browns & warm orange, leaves & acorns */
body[data-theme="professor-hoot-mysteries"] {
  --bg1: #fff8e1; --bg2: #ffe0b2; --bg3: #fbe9e7;
  --accent: #ff8a65; --accent-strong: #f4511e;
  --accent-glow: rgba(255, 138, 101, 0.4);
  --gold: #ffab91; --gold-glow: rgba(255, 171, 145, 0.5);
  --ink: #3e2723;
  --bubble1: #ffab91; --bubble2: #ffe0b2;
  --deco1: "\1f341"; --deco2: "\1f330"; --deco3: "\1f342";
  --deco4: "\1f989"; --deco5: "\1f341"; --deco6: "\1f56e";
}

/* Grug's Garden — lush greens & earthy browns, ferns & mushrooms */
body[data-theme="grug-garden"] {
  --bg1: #e8f5e9; --bg2: #c8e6c9; --bg3: #f1f8e9;
  --accent: #66bb6a; --accent-strong: #43a047;
  --accent-glow: rgba(102, 187, 106, 0.4);
  --gold: #a5d6a7; --gold-glow: rgba(165, 214, 167, 0.5);
  --ink: #1b2a1b;
  --bubble1: #81c784; --bubble2: #dce775;
  --deco1: "\1f344"; --deco2: "\1f33f"; --deco3: "\1f41b";
  --deco4: "\1f33b"; --deco5: "\1f344"; --deco6: "\1f343";
}

/* ===== Base styles ===== */

* { box-sizing: border-box; }
html, body {
  margin: 0;
  min-height: 100%;
  font-family: "Quicksand", "Trebuchet MS", "Segoe UI", sans-serif;
  color: var(--ink);
  background: linear-gradient(140deg, var(--bg1), var(--bg2) 45%, var(--bg3));
  overflow-x: hidden;
}

body {
  display: flex;
  justify-content: center;
  padding: max(12px, env(safe-area-inset-top)) 10px max(14px, env(safe-area-inset-bottom));
}

/* --- Floating blobs background --- */
body::before,
body::after {
  content: "";
  position: fixed;
  border-radius: 50%;
  opacity: 0.10;
  z-index: 0;
  pointer-events: none;
  animation: floatBubble 18s ease-in-out infinite;
}
body::before {
  width: 220px; height: 220px;
  background: var(--bubble1);
  top: 10%; left: -60px;
}
body::after {
  width: 160px; height: 160px;
  background: var(--bubble2);
  bottom: 8%; right: -40px;
  animation-delay: -7s;
  animation-duration: 22s;
}

@keyframes floatBubble {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-30px) scale(1.08); }
}

/* --- Decorative emoji particles --- */
.deco {
  position: fixed;
  z-index: 0;
  pointer-events: none;
  font-size: 1.4rem;
  opacity: 0;
  animation: decoFloat 16s ease-in-out infinite;
}
.deco:nth-child(1) { left: 5%;  top: 15%; animation-delay: 0s;    font-size: 1.5rem; }
.deco:nth-child(2) { right: 8%; top: 20%; animation-delay: -3s;   font-size: 1.2rem; }
.deco:nth-child(3) { left: 12%; bottom: 18%; animation-delay: -6s; font-size: 1.6rem; }
.deco:nth-child(4) { right: 6%; bottom: 25%; animation-delay: -9s; font-size: 1.1rem; }
.deco:nth-child(5) { left: 50%; top: 8%;  animation-delay: -12s;  font-size: 1.3rem; }
.deco:nth-child(6) { right: 15%; top: 70%; animation-delay: -2s;  font-size: 1.4rem; }

@keyframes decoFloat {
  0%, 100% {
    opacity: 0;
    transform: translateY(0) rotate(0deg) scale(0.8);
  }
  15% {
    opacity: 0.22;
  }
  50% {
    opacity: 0.18;
    transform: translateY(-20px) rotate(15deg) scale(1);
  }
  85% {
    opacity: 0.22;
  }
}

.app {
  position: relative;
  z-index: 1;
  width: min(100%, 720px);
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 10px;
  min-height: calc(100dvh - 26px);
}

/* --- Top bar --- */
.topbar {
  display: grid;
  grid-template-columns: 64px 1fr 64px;
  align-items: center;
  gap: 8px;
}

.meta { text-align: center; }

#bookTitle {
  margin: 0;
  font-size: clamp(1.1rem, 3vw, 1.4rem);
  font-weight: 700;
}

#pageMeta {
  margin: 4px 0 0;
  color: var(--muted);
  font-size: 0.85rem;
  font-weight: 500;
}

/* --- Buttons (shared) --- */
.nav-btn,
.pill {
  border: 1px solid var(--border);
  background: var(--pill);
  border-radius: 999px;
  min-height: 42px;
  padding: 0 14px;
  font-family: inherit;
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--ink);
  cursor: pointer;
  transition: transform 0.12s, box-shadow 0.2s, background 0.2s;
}

.nav-btn:hover,
.pill:hover {
  box-shadow: 0 4px 14px rgba(0,0,0,0.10);
  transform: translateY(-1px);
}

.nav-btn:active,
.pill:active {
  transform: translateY(1px);
  box-shadow: none;
}

/* --- Page card --- */
.page-card {
  display: grid;
  grid-template-rows: minmax(0, 60%) minmax(0, 40%);
  background: var(--card);
  border-radius: 24px;
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 2px solid rgba(255, 255, 255, 0.8);
  transition: opacity 0.22s ease, transform 0.22s ease;
}

.page-card.fade-out {
  opacity: 0;
  transform: translateY(8px) scale(0.98);
}

/* --- Image area --- */
.image-wrap {
  background: #edf3ff;
  overflow: hidden;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 6px;
}

.image-wrap img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: opacity 0.3s ease;
  mask-image: radial-gradient(ellipse 92% 92% at center, black 70%, transparent 100%);
  -webkit-mask-image: radial-gradient(ellipse 92% 92% at center, black 70%, transparent 100%);
}

.image-wrap img.loading {
  opacity: 0;
}

/* Shimmer skeleton */
.shimmer {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    110deg,
    #edf3ff 30%,
    #f7f0ff 48%,
    #edf3ff 66%
  );
  background-size: 300% 100%;
  animation: shimmerSlide 1.6s ease-in-out infinite;
}

.shimmer.hidden {
  display: none;
}

@keyframes shimmerSlide {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* --- Text area --- */
.text-wrap {
  padding: clamp(12px, 2.7vw, 22px);
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.story-text {
  margin: 0;
  font-size: clamp(1.05rem, 3.5vw, 1.45rem);
  line-height: 1.55;
  font-weight: 500;
}

/* Word reveal */
.story-text span {
  transition: opacity 0.25s ease, text-shadow 0.3s ease;
}

.word-hidden {
  opacity: 0.15;
}

.word-current {
  text-shadow: 0 0 8px var(--gold-glow);
}

/* --- Footer controls --- */
.controls {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.player {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

#playPauseBtn {
  background: var(--accent);
  border-color: transparent;
  color: #fff;
}

#playPauseBtn:hover {
  background: var(--accent-strong);
  box-shadow: 0 4px 16px var(--accent-glow);
}

#autoplayBtn {
  background: var(--accent-strong);
  border-color: transparent;
  color: #fff;
}

#autoplayBtn.off {
  background: var(--pill);
  color: var(--muted);
  border-color: var(--border);
}

#autoplayBtn:hover {
  box-shadow: 0 4px 16px var(--accent-glow);
}

/* --- Progress dots --- */
.dots {
  display: flex;
  justify-content: center;
  gap: 7px;
  flex-wrap: wrap;
  padding: 2px 0;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.5);
  border: 1.5px solid rgba(0, 0, 0, 0.08);
  transition: transform 0.25s ease, background 0.25s ease, box-shadow 0.25s ease;
}

.dot.active {
  background: var(--accent);
  transform: scale(1.35);
  box-shadow: 0 0 8px var(--accent-glow);
}

.dot.visited {
  background: rgba(255, 143, 171, 0.35);
}

/* --- Responsive --- */
@media (min-width: 768px) {
  .app {
    min-height: 92dvh;
  }
  .topbar {
    grid-template-columns: 80px 1fr 80px;
  }
  .player {
    max-width: 420px;
    margin: 0 auto;
  }
}

/* --- Landscape: image left, text right, everything fits on screen --- */
@media (orientation: landscape) {
  body {
    padding-top: 6px;
    padding-bottom: max(6px, env(safe-area-inset-bottom));
    align-items: center;
  }

  .app {
    width: min(100%, 1100px);
    min-height: 0;
    height: calc(100dvh - 12px);
    max-height: 600px;
    gap: 4px;
    grid-template-rows: auto 1fr auto;
  }

  .topbar {
    gap: 6px;
  }

  #bookTitle {
    font-size: clamp(0.85rem, 2.2vw, 1.2rem);
  }

  #pageMeta {
    font-size: 0.75rem;
    margin-top: 1px;
  }

  .nav-btn {
    min-height: 34px;
    padding: 0 10px;
    font-size: 0.8rem;
  }

  .page-card {
    grid-template-columns: minmax(0, 55%) minmax(0, 45%);
    grid-template-rows: 1fr;
    min-height: 0;
    border-radius: 18px;
  }

  .image-wrap {
    padding: 6px;
  }

  .text-wrap {
    text-align: left;
    padding: clamp(10px, 2vw, 22px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .story-text {
    font-size: clamp(0.85rem, 2vw, 1.3rem);
    line-height: 1.45;
  }

  /* Controls: 2-column layout matching card split */
  .controls {
    display: grid;
    grid-template-columns: minmax(0, 55%) minmax(0, 45%);
    gap: 4px;
    align-items: center;
  }

  .dots {
    grid-column: 1 / 2;
    gap: 5px;
    padding: 0;
    justify-content: center;
  }

  .player {
    grid-column: 2 / 3;
    grid-row: 1;
    gap: 6px;
    max-width: 300px;
    justify-self: center;
  }

  .dot {
    width: 8px;
    height: 8px;
  }

  .pill {
    min-height: 34px;
    font-size: 0.8rem;
  }
}

/* --- Large landscape screens (tablets, desktops): tighten layout --- */
@media (orientation: landscape) and (min-width: 1024px) {
  .app {
    width: min(88%, 900px);
    max-height: 640px;
  }

  .page-card {
    grid-template-columns: minmax(0, 50%) minmax(0, 50%);
    border-radius: 22px;
  }

  .image-wrap {
    padding: 8px;
  }

  .text-wrap {
    padding: clamp(16px, 2.5vw, 32px);
  }

  .story-text {
    font-size: clamp(1rem, 1.8vw, 1.35rem);
    max-width: 38ch;
  }

  .controls {
    grid-template-columns: minmax(0, 50%) minmax(0, 50%);
  }

  .player {
    max-width: 280px;
  }

  .pill {
    min-height: 38px;
    font-size: 0.85rem;
  }
}

/* --- Reduce motion for accessibility --- */
@media (prefers-reduced-motion: reduce) {
  body::before, body::after, .deco {
    animation: none;
    opacity: 0;
  }
}

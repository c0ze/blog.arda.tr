---
---

<button
  class="theme-toggle flex items-center justify-center w-9 h-9 rounded-full bg-secondary border border-border text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
  aria-label="Toggle theme"
  type="button"
>
  <span class="theme-icon-dark hidden">
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
    </svg>
  </span>
  <span class="theme-icon-light hidden">
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="4"/>
      <path d="M12 2v2"/>
      <path d="M12 20v2"/>
      <path d="m4.93 4.93 1.41 1.41"/>
      <path d="m17.66 17.66 1.41 1.41"/>
      <path d="M2 12h2"/>
      <path d="M20 12h2"/>
      <path d="m6.34 17.66-1.41 1.41"/>
      <path d="m19.07 4.93-1.41 1.41"/>
    </svg>
  </span>
  <span class="theme-icon-dracula hidden">
    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" />
      <path d="M8 14l2-4 2 4" />
      <path d="M12 14l2-4 2 4" />
    </svg>
  </span>
</button>

<script is:inline>
(function() {
  const themes = ['dark', 'light', 'dracula'];

  function getTheme() {
    return localStorage.getItem('theme') || 'dark';
  }

  function setTheme(theme) {
    document.documentElement.classList.remove('dark', 'light', 'dracula');
    document.documentElement.classList.add(theme);
    localStorage.setItem('theme', theme);
    updateIcons(theme);
  }

  function updateIcons(theme) {
    document.querySelectorAll('.theme-toggle').forEach(function(button) {
      button.querySelector('.theme-icon-dark')?.classList.add('hidden');
      button.querySelector('.theme-icon-light')?.classList.add('hidden');
      button.querySelector('.theme-icon-dracula')?.classList.add('hidden');
      button.querySelector('.theme-icon-' + theme)?.classList.remove('hidden');
    });
  }

  function cycleTheme(e) {
    e.preventDefault();
    e.stopPropagation();
    var current = getTheme();
    var currentIndex = themes.indexOf(current);
    var nextIndex = (currentIndex + 1) % themes.length;
    setTheme(themes[nextIndex]);
  }

  function initThemeToggle() {
    // Update icons for current theme
    updateIcons(getTheme());

    // Attach click handlers using event delegation on document
    // This ensures it works even if buttons are added dynamically
    document.querySelectorAll('.theme-toggle').forEach(function(button) {
      // Remove any existing listeners by cloning
      if (!button.hasAttribute('data-theme-init')) {
        button.setAttribute('data-theme-init', 'true');
        button.addEventListener('click', cycleTheme);
        // Also handle touch events for mobile
        button.addEventListener('touchend', function(e) {
          e.preventDefault();
          cycleTheme(e);
        });
      }
    });
  }

  // Run on DOMContentLoaded and also immediately if DOM is already ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle);
  } else {
    initThemeToggle();
  }

  // Also run on astro:page-load for View Transitions support
  document.addEventListener('astro:page-load', initThemeToggle);
})();
</script>
